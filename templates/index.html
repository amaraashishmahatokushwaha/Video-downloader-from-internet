<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>YouTube Downloader Pro</title>
  <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
  <style>
    :root {
      --primary: #ff0000;
      --primary-dark: #cc0000;
      --secondary: #2c3e50;
      --light: #f8f9fa;
      --dark: #343a40;
      --success: #28a745;
      --danger: #dc3545;
      --warning: #ffc107;
      --info: #17a2b8;
    }
    
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }
    
    body {
      font-family: 'Segoe UI', 'Roboto', sans-serif;
      background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);
      min-height: 100vh;
      color: var(--dark);
      padding: 40px 20px;
    }
    
    .container {
      width: 90%;
      max-width: 800px;
      margin: 0 auto;
      background: white;
      border-radius: 16px;
      box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
      padding: 30px;
      position: relative;
      overflow: hidden;
    }
    
    .header {
      text-align: center;
      margin-bottom: 30px;
    }
    
    .header h1 {
      font-size: 2.2rem;
      color: var(--primary);
      margin-bottom: 10px;
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 10px;
    }
    
    .header p {
      color: var(--secondary);
      font-size: 1rem;
      opacity: 0.8;
    }
    
    .form-group {
      margin-bottom: 20px;
    }
    
    .form-control {
      width: 100%;
      padding: 15px;
      border: 2px solid #ddd;
      border-radius: 10px;
      font-size: 1rem;
      transition: all 0.3s ease;
      outline: none;
    }
    
    .form-control:focus {
      border-color: var(--primary);
      box-shadow: 0 0 0 3px rgba(255, 0, 0, 0.2);
    }
    
    .btn {
      width: 100%;
      padding: 15px;
      border: none;
      border-radius: 10px;
      font-size: 1rem;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.3s ease;
      display: flex;
      justify-content: center;
      align-items: center;
      gap: 10px;
    }
    
    .btn-primary {
      background-color: var(--primary);
      color: white;
    }
    
    .btn-primary:hover:not(:disabled) {
      background-color: var(--primary-dark);
      transform: translateY(-2px);
    }
    
    .btn-danger {
      background-color: var(--danger);
      color: white;
    }
    
    .btn-danger:hover:not(:disabled) {
      background-color: #bd2130;
      transform: translateY(-2px);
    }
    
    .btn:disabled {
      opacity: 0.6;
      cursor: not-allowed;
    }
    
    .controls {
      display: flex;
      gap: 15px;
      margin-top: 20px;
    }
    
    .controls .btn {
      flex: 1;
    }
    
    .output-container {
      margin-top: 25px;
      position: relative;
      border-radius: 10px;
      overflow: hidden;
    }
    
    .output-header {
      background-color: var(--secondary);
      color: white;
      padding: 10px 15px;
      font-weight: 600;
      font-size: 0.9rem;
      display: flex;
      justify-content: space-between;
      align-items: center;
    }
    
    .output-body {
      height: 200px;
      overflow-y: auto;
      background-color: #2d3748;
      color: #e2e8f0;
      padding: 15px;
      font-family: 'Consolas', 'Monaco', monospace;
      font-size: 0.9rem;
      white-space: pre-wrap;
      line-height: 1.5;
    }
    
    .progress-container {
      position: relative;
      width: 120px;
      height: 120px;
      margin: 20px auto;
      transition: all 0.3s ease;
      display: none;
    }
    
    .progress-container.active {
      display: block;
    }
    
    .progress-ring {
      width: 100%;
      height: 100%;
      transform: rotate(-90deg);
    }
    
    .progress-circle {
      fill: transparent;
      stroke: #e0e0e0;
      stroke-width: 8;
    }
    
    .progress-value {
      fill: transparent;
      stroke: var(--primary);
      stroke-width: 8;
      stroke-linecap: round;
      transition: stroke-dashoffset 0.3s ease;
    }
    
    .progress-text {
      position: absolute;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      font-size: 1.5rem;
      font-weight: bold;
      color: var(--primary);
    }
    
    .tabs {
      display: flex;
      border-bottom: 2px solid #eee;
      margin-bottom: 20px;
    }
    
    .tab {
      padding: 10px 20px;
      font-weight: 600;
      cursor: pointer;
      position: relative;
      transition: all 0.3s ease;
      color: var(--secondary);
    }
    
    .tab.active {
      color: var(--primary);
    }
    
    .tab.active::after {
      content: '';
      position: absolute;
      bottom: -2px;
      left: 0;
      width: 100%;
      height: 2px;
      background-color: var(--primary);
    }
    
    .tab-content {
      display: none;
    }
    
    .tab-content.active {
      display: block;
      animation: fadeIn 0.3s ease;
    }
    
    .format-options {
      display: grid;
      grid-template-columns: repeat(2, 1fr);
      gap: 10px;
      margin-bottom: 20px;
    }
    
    .format-option {
      position: relative;
    }
    
    .format-option input {
      position: absolute;
      opacity: 0;
      width: 0;
      height: 0;
    }
    
    .format-option label {
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      text-align: center;
      padding: 15px;
      border: 2px solid #ddd;
      border-radius: 10px;
      cursor: pointer;
      transition: all 0.3s ease;
      height: 100%;
    }
    
    .format-option input:checked + label {
      border-color: var(--primary);
      background-color: rgba(255, 0, 0, 0.05);
    }
    
    .format-option i {
      font-size: 1.5rem;
      margin-bottom: 8px;
      color: var(--secondary);
    }
    
    .format-option input:checked + label i {
      color: var(--primary);
    }
    
    .format-name {
      font-weight: 600;
      font-size: 0.9rem;
    }
    
    .format-desc {
      font-size: 0.75rem;
      opacity: 0.8;
      margin-top: 5px;
    }
    
    .quality-selector {
      margin-top: 20px;
    }
    
    .quality-selector h3 {
      font-size: 1rem;
      margin-bottom: 10px;
      color: var(--secondary);
    }
    
    .quality-options {
      display: grid;
      grid-template-columns: repeat(3, 1fr);
      gap: 10px;
    }
    
    .quality-options .format-option label {
      padding: 10px;
    }
    
    .playlist-options {
      margin-top: 20px;
    }
    
    .playlist-options h3 {
      font-size: 1rem;
      margin-bottom: 10px;
      color: var(--secondary);
    }
    
    .playlist-range {
      display: flex;
      gap: 10px;
      align-items: center;
      margin-top: 10px;
    }
    
    .playlist-range input {
      flex: 1;
      padding: 10px;
      border: 1px solid #ddd;
      border-radius: 5px;
    }
    
    .checkbox-group {
      display: flex;
      gap: 5px;
      align-items: center;
      margin-top: 10px;
    }
    
    .checkbox-group input {
      width: 18px;
      height: 18px;
    }
    
    .help-container {
      margin-top: 40px;
      padding-top: 20px;
      border-top: 1px solid #eee;
    }
    
    .help-container h2 {
      color: var(--secondary);
      font-size: 1.5rem;
      margin-bottom: 15px;
      text-align: center;
    }
    
    .faq-item {
      margin-bottom: 15px;
      border: 1px solid #eee;
      border-radius: 8px;
      overflow: hidden;
    }
    
    .faq-question {
      padding: 15px;
      font-weight: 600;
      background-color: #f8f9fa;
      cursor: pointer;
      display: flex;
      justify-content: space-between;
      align-items: center;
    }
    
    .faq-answer {
      padding: 0 15px;
      max-height: 0;
      overflow: hidden;
      transition: all 0.3s ease;
      line-height: 1.6;
    }
    
    .faq-item.active .faq-answer {
      padding: 15px;
      max-height: 500px;
    }
    
    .faq-item.active .faq-toggle i {
      transform: rotate(180deg);
    }
    
    .success-icon {
      color: var(--success);
      animation: pulse 1.5s infinite;
    }
    
    .tooltip {
      position: relative;
      display: inline-block;
      cursor: help;
    }
    
    .tooltip .tooltiptext {
      visibility: hidden;
      width: 200px;
      background-color: var(--secondary);
      color: #fff;
      text-align: center;
      border-radius: 6px;
      padding: 10px;
      position: absolute;
      z-index: 1;
      bottom: 125%;
      left: 50%;
      transform: translateX(-50%);
      opacity: 0;
      transition: opacity 0.3s;
      font-size: 0.8rem;
    }
    
    .tooltip:hover .tooltiptext {
      visibility: visible;
      opacity: 1;
    }
    
    @keyframes pulse {
      0% {
        transform: scale(1);
      }
      50% {
        transform: scale(1.2);
      }
      100% {
        transform: scale(1);
      }
    }
    
    .shake {
      animation: shake 0.5s;
    }
    
    @keyframes shake {
      0%, 100% { transform: translateX(0); }
      10%, 30%, 50%, 70%, 90% { transform: translateX(-5px); }
      20%, 40%, 60%, 80% { transform: translateX(5px); }
    }
    
    .fade-in {
      animation: fadeIn 0.5s;
    }
    
    @keyframes fadeIn {
      from { opacity: 0; }
      to { opacity: 1; }
    }
    
    .features {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
      gap: 20px;
      margin: 30px 0;
    }
    
    .feature {
      background-color: #f8f9fa;
      border-radius: 10px;
      padding: 20px;
      text-align: center;
      transition: transform 0.3s ease;
    }
    
    .feature:hover {
      transform: translateY(-5px);
    }
    
    .feature i {
      font-size: 2rem;
      color: var(--primary);
      margin-bottom: 10px;
    }
    
    .feature h3 {
      font-size: 1.2rem;
      margin-bottom: 10px;
      color: var(--secondary);
    }
    
    .feature p {
      font-size: 0.9rem;
      color: #666;
    }
    
    /* Media queries for responsive design */
    @media (max-width: 768px) {
      .format-options,
      .quality-options {
        grid-template-columns: 1fr;
      }
      
      .playlist-range {
        flex-direction: column;
        align-items: stretch;
      }
      
      .controls {
        flex-direction: column;
      }
    }
  </style>
</head>
<body>
  <div class="container fade-in">
    <div class="header">
      <h1><i class="fab fa-youtube"></i> YouTube Downloader Pro</h1>
      <p>Download single videos or playlists in various quality options</p>
    </div>
    
    <div class="tabs">
      <div class="tab active" data-tab="video">Single Video</div>
      <div class="tab" data-tab="playlist">Playlist</div>
    </div>
    
    <form id="downloadForm">
      <div class="form-group">
        <input type="url" id="url" class="form-control" placeholder="Enter YouTube URL" required />
      </div>
      
      <!-- Single Video Tab Content -->
      <div class="tab-content active" id="videoContent">
        <div class="format-options">
          <div class="format-option">
            <input type="radio" id="videoHD" name="format" value="bestvideo+bestaudio" checked />
            <label for="videoHD">
              <i class="fas fa-film"></i>
              <div class="format-name">Video</div>
              <div class="format-desc">With audio</div>
            </label>
          </div>
          
          <div class="format-option">
            <input type="radio" id="audioOnly" name="format" value="bestaudio[ext=m4a]" />
            <label for="audioOnly">
              <i class="fas fa-music"></i>
              <div class="format-name">Audio Only</div>
              <div class="format-desc">M4A format</div>
            </label>
          </div>
          
          <div class="format-option">
            <input type="radio" id="mp3Convert" name="format" value="mp3" />
            <label for="mp3Convert">
              <i class="fas fa-headphones"></i>
              <div class="format-name">MP3</div>
              <div class="format-desc">Converted audio</div>
            </label>
          </div>
          
          <div class="format-option">
            <input type="radio" id="videoOnly" name="format" value="bestvideo" />
            <label for="videoOnly">
              <i class="fas fa-video"></i>
              <div class="format-name">Video Only</div>
              <div class="format-desc">No audio</div>
            </label>
          </div>
        </div>
        
        <div class="quality-selector">
          <h3>Video Quality <span class="tooltip"><i class="fas fa-info-circle"></i><span class="tooltiptext">Higher quality means larger file size</span></span></h3>
          <div class="quality-options">
            <div class="format-option">
              <input type="radio" id="quality-best" name="video-quality" value="best" checked />
              <label for="quality-best">
                <i class="fas fa-trophy"></i>
                <div class="format-name">Best</div>
                <div class="format-desc">Highest available</div>
              </label>
            </div>
            
            <div class="format-option">
              <input type="radio" id="quality-1080p" name="video-quality" value="137+140/bestvideo[height<=1080]+bestaudio" />
              <label for="quality-1080p">
                <i class="fas fa-tv"></i>
                <div class="format-name">1080p</div>
                <div class="format-desc">Full HD</div>
              </label>
            </div>
            
            <div class="format-option">
              <input type="radio" id="quality-720p" name="video-quality" value="136+140/bestvideo[height<=720]+bestaudio" />
              <label for="quality-720p">
                <i class="fas fa-desktop"></i>
                <div class="format-name">720p</div>
                <div class="format-desc">HD</div>
              </label>
            </div>
            
            <div class="format-option">
              <input type="radio" id="quality-480p" name="video-quality" value="135+140/bestvideo[height<=480]+bestaudio" />
              <label for="quality-480p">
                <i class="fas fa-tablet-alt"></i>
                <div class="format-name">480p</div>
                <div class="format-desc">Standard</div>
              </label>
            </div>
            
            <div class="format-option">
              <input type="radio" id="quality-360p" name="video-quality" value="134+140/bestvideo[height<=360]+bestaudio" />
              <label for="quality-360p">
                <i class="fas fa-mobile-alt"></i>
                <div class="format-name">360p</div>
                <div class="format-desc">Low</div>
              </label>
            </div>
            
            <div class="format-option">
              <input type="radio" id="quality-240p" name="video-quality" value="133+140/bestvideo[height<=240]+bestaudio" />
              <label for="quality-240p">
                <i class="fas fa-signal"></i>
                <div class="format-name">240p</div>
                <div class="format-desc">Very Low</div>
              </label>
            </div>
          </div>
        </div>
      </div>
      
      <!-- Playlist Tab Content -->
      <div class="tab-content" id="playlistContent">
        <div class="format-options">
          <div class="format-option">
            <input type="radio" id="playlistVideo" name="playlist-format" value="bestvideo+bestaudio" checked />
            <label for="playlistVideo">
              <i class="fas fa-film"></i>
              <div class="format-name">Video</div>
              <div class="format-desc">With audio</div>
            </label>
          </div>
          
          <div class="format-option">
            <input type="radio" id="playlistAudio" name="playlist-format" value="bestaudio[ext=m4a]" />
            <label for="playlistAudio">
              <i class="fas fa-music"></i>
              <div class="format-name">Audio Only</div>
              <div class="format-desc">M4A format</div>
            </label>
          </div>
        </div>
        
        <div class="quality-selector">
          <h3>Video Quality</h3>
          <div class="quality-options">
            <div class="format-option">
              <input type="radio" id="playlist-quality-best" name="playlist-quality" value="best" checked />
              <label for="playlist-quality-best">
                <i class="fas fa-trophy"></i>
                <div class="format-name">Best</div>
              </label>
            </div>
            
            <div class="format-option">
              <input type="radio" id="playlist-quality-720p" name="playlist-quality" value="bestvideo[height<=720]+bestaudio/best[height<=720]" />
              <label for="playlist-quality-720p">
                <i class="fas fa-desktop"></i>
                <div class="format-name">720p</div>
              </label>
            </div>
            
            <div class="format-option">
              <input type="radio" id="playlist-quality-480p" name="playlist-quality" value="bestvideo[height<=480]+bestaudio/best[height<=480]" />
              <label for="playlist-quality-480p">
                <i class="fas fa-tablet-alt"></i>
                <div class="format-name">480p</div>
              </label>
            </div>
          </div>
        </div>
        
        <div class="playlist-options">
          <h3>Playlist Options</h3>
          
          <div class="checkbox-group">
            <input type="checkbox" id="playlistFullDownload" checked />
            <label for="playlistFullDownload">Download entire playlist</label>
          </div>
          
          <div class="playlist-range" id="playlistRangeSelector" style="display: none;">
            <input type="number" id="playlistStart" placeholder="Start index (e.g., 1)" min="1" class="form-control" />
            <input type="number" id="playlistEnd" placeholder="End index (e.g., 10)" min="1" class="form-control" />
          </div>
          
          <div class="checkbox-group">
            <input type="checkbox" id="createPlaylistFolder" checked />
            <label for="createPlaylistFolder">Create folder for playlist</label>
          </div>
        </div>
      </div>
      
      <button type="submit" id="startBtn" class="btn btn-primary">
        <i class="fas fa-download"></i> Start Download
      </button>
    </form>
    
    <div class="progress-container" id="progressContainer">
      <svg class="progress-ring" width="120" height="120">
        <circle class="progress-circle" cx="60" cy="60" r="54"></circle>
        <circle class="progress-value" cx="60" cy="60" r="54" id="progressValue"></circle>
      </svg>
      <div class="progress-text" id="progressText">0%</div>
    </div>
    
    <div class="output-container">
      <div class="output-header">
        <span>Download Status</span>
        <span id="statusIndicator">Ready</span>
      </div>
      <div class="output-body" id="output">⏳ Awaiting download...</div>
    </div>
    
    <div class="controls">
      <button id="stopBtn" class="btn btn-danger" disabled>
        <i class="fas fa-stop"></i> Stop Download
      </button>
    </div>
    
    <!-- Features section -->
    <div class="features">
      <div class="feature">
        <i class="fas fa-download"></i>
        <h3>Single Videos</h3>
        <p>Download any YouTube video in your preferred quality format</p>
      </div>
      <div class="feature">
        <i class="fas fa-list"></i>
        <h3>Playlists</h3>
        <p>Download entire playlists or select specific videos from a range</p>
      </div>
      <div class="feature">
        <i class="fas fa-sliders-h"></i>
        <h3>Quality Options</h3>
        <p>Choose from multiple quality options to balance size and quality</p>
      </div>
    </div>
    
    <!-- Help section -->
    <div class="help-container">
      <h2>How to Use</h2>
      
      <div class="faq-item">
        <div class="faq-question">
          How do I download a single YouTube video? <span class="faq-toggle"><i class="fas fa-chevron-down"></i></span>
        </div>
        <div class="faq-answer">
          <ol>
            <li>Copy the URL of the YouTube video you want to download</li>
            <li>Make sure the "Single Video" tab is selected</li>
            <li>Paste the URL in the input field</li>
            <li>Choose your preferred format (Video, Audio Only, or MP3)</li>
            <li>Select the desired video quality</li>
            <li>Click "Start Download"</li>
            <li>Wait for the download to complete</li>
            <li>Your file will be saved in the "downloads" folder</li>
          </ol>
        </div>
      </div>
      
      <div class="faq-item">
        <div class="faq-question">
          How do I download a YouTube playlist? <span class="faq-toggle"><i class="fas fa-chevron-down"></i></span>
        </div>
        <div class="faq-answer">
          <ol>
            <li>Copy the URL of the YouTube playlist</li>
            <li>Click on the "Playlist" tab</li>
            <li>Paste the URL in the input field</li>
            <li>Choose your preferred format (Video or Audio)</li>
            <li>Select the desired quality</li>
            <li>Decide if you want to download the entire playlist or a specific range</li>
            <li>Click "Start Download"</li>
            <li>Your files will be saved in a folder named after the playlist</li>
          </ol>
          <p><strong>Note:</strong> Downloading large playlists may take a long time depending on your internet connection.</p>
        </div>
      </div>
      
      <div class="faq-item">
        <div class="faq-question">
          What formats are available? <span class="faq-toggle"><i class="fas fa-chevron-down"></i></span>
        </div>
        <div class="faq-answer">
          <ul>
            <li><strong>Video (with audio):</strong> Downloads the video with audio in MP4 format</li>
            <li><strong>Audio Only:</strong> Downloads just the audio track in M4A format</li>
            <li><strong>MP3:</strong> Converts the audio to MP3 format (may take longer)</li>
            <li><strong>Video Only:</strong> Downloads just the video with no audio</li>
          </ul>
          <p>For best quality, choose "Best" in the quality options. If you want to save space or have a slower connection, select a lower quality option.</p>
        </div>
      </div>
      
      <div class="faq-item">
        <div class="faq-question">
          Where are my downloaded files saved? <span class="faq-toggle"><i class="fas fa-chevron-down"></i></span>
        </div>
        <div class="faq-answer">
          <p>All downloads are saved in the "downloads" folder in the same directory as this application. For playlists, a subfolder will be created with the playlist name.</p>
          <p>The file naming format is based on the video title. Special characters in titles will be automatically replaced with safe characters.</p>
        </div>
      </div>
      
      <div class="faq-item">
        <div class="faq-question">
          Common issues and troubleshooting <span class="faq-toggle"><i class="fas fa-chevron-down"></i></span>
        </div>
        <div class="faq-answer">
          <ul>
            <li><strong>Download fails immediately:</strong> Make sure the URL is correct and the video is available in your country.</li>
            <li><strong>Download starts but then stops:</strong> This could be due to network issues or YouTube restrictions. Try again or choose a lower quality.</li>
            <li><strong>MP3 conversion fails:</strong> Make sure you have ffmpeg installed on your system. The downloader requires ffmpeg for MP3 conversion.</li>
            <li><strong>Playlist download is incomplete:</strong> For very large playlists, some videos might fail to download due to restrictions. Check the logs for details.</li>
          </ul>
          <p>If you encounter persistent issues, try restarting the application or check if yt-dlp needs to be updated.</p>
        </div>
      </div>
    </div>
  </div>

  <script>
    // Tab switching functionality
    const tabs = document.querySelectorAll('.tab');
    const tabContents = document.querySelectorAll('.tab-content');
    
    tabs.forEach(tab => {
      tab.addEventListener('click', () => {
        // Remove active class from all tabs and contents
        tabs.forEach(t => t.classList.remove('active'));
        tabContents.forEach(c => c.classList.remove('active'));
        
        // Add active class to clicked tab and corresponding content
        tab.classList.add('active');
        const contentId = tab.getAttribute('data-tab') + 'Content';
        document.getElementById(contentId).classList.add('active');
      });
    });
    
    // FAQ accordion functionality
    const faqItems = document.querySelectorAll('.faq-item');
    
    faqItems.forEach(item => {
      const question = item.querySelector('.faq-question');
      question.addEventListener('click', () => {
        item.classList.toggle('active');
      });
    });
    
    // Playlist range toggle
    const playlistFullDownload = document.getElementById('playlistFullDownload');
    const playlistRangeSelector = document.getElementById('playlistRangeSelector');
    
    playlistFullDownload.addEventListener('change', () => {
      playlistRangeSelector.style.display = playlistFullDownload.checked ? 'none' : 'flex';
    });
    
    // Form elements
    const form = document.getElementById('downloadForm');
    const output = document.getElementById('output');
    const stopBtn = document.getElementById('stopBtn');
    const startBtn = document.getElementById('startBtn');
    const progressContainer = document.getElementById('progressContainer');
    const progressValue = document.getElementById('progressValue');
    const progressText = document.getElementById('progressText');
    const statusIndicator = document.getElementById('statusIndicator');
    
    let downloadProcess;
    let progressInterval;
    
    // Calculate circumference for progress circle
    const radius = 54;
    const circumference = 2 * Math.PI * radius;
    progressValue.style.strokeDasharray = `${circumference} ${circumference}`;
    progressValue.style.strokeDashoffset = circumference;
    
    // Function to update progress
    function updateProgress(percent) {
      const offset = circumference - (percent / 100 * circumference);
      progressValue.style.strokeDashoffset = offset;
      progressText.textContent = `${Math.round(percent)}%`;
    }
    
    // Function to update status indicator
    function updateStatus(status, isError = false) {
      statusIndicator.textContent = status;
      if (isError) {
        statusIndicator.style.color = 'var(--danger)';
      } else {
        statusIndicator.style.color = 'var(--success)';
      }
    }
    
    // Function to extract progress from yt-dlp output
    function extractProgress(line) {
      const downloadRegex = /(\d+(\.\d+)?)%/;
      const match = line.match(downloadRegex);
      if (match) {
        return parseFloat(match[1]);
      }
      return null;
    }
    
    // Function to build download command based on selected options
    function buildDownloadOptions() {
      const url = document.getElementById('url').value;
      const activeTab = document.querySelector('.tab.active').getAttribute('data-tab');
      let options = {};
      
      options.url = url;
      
      if (activeTab === 'video') {
        // Get format selection for single video
        const formatRadios = document.getElementsByName('format');
        for (const radio of formatRadios) {
          if (radio.checked) {
            options.format = radio.value;
            break;
          }
        }
        
        // Get quality selection for single video if video format is selected
        if (options.format !== 'mp3' && options.format !== 'bestaudio[ext=m4a]') {
          const qualityRadios = document.getElementsByName('video-quality');
          for (const radio of qualityRadios) {
            if (radio.checked) {
              options.quality = radio.value;
              break;
            }
          }
        }
      } else if (activeTab === 'playlist') {
        // Set playlist flag
        options.isPlaylist = true;
        
        // Get format selection for playlist
        const formatRadios = document.getElementsByName('playlist-format');
        for (const radio of formatRadios) {
          if (radio.checked) {
            options.format = radio.value;
            break;
          }
        }
        
        // Get quality selection for playlist
        const qualityRadios = document.getElementsByName('playlist-quality');
        for (const radio of qualityRadios) {
          if (radio.checked) {
            options.quality = radio.value;
            break;
          }
        }
        
        // Check if downloading full playlist or range
        const fullPlaylist = document.getElementById('playlistFullDownload').checked;
        if (!fullPlaylist) {
          options.playlistStart = document.getElementById('playlistStart').value || '1';
          options.playlistEnd = document.getElementById('playlistEnd').value || '';
        }
        
        // Check if creating folder for playlist
        options.createFolder = document.getElementById('createPlaylistFolder').checked;
      }
      
      return options;
    }
    
    form.addEventListener('submit', async (e) => {
      e.preventDefault();
      
      const url = document.getElementById('url').value;
      
      if (!url) {
        document.getElementById('url').classList.add('shake');
        setTimeout(() => {
          document.getElementById('url').classList.remove('shake');
        }, 500);
        return;
      }
      
      // Get all download options
      const downloadOptions = buildDownloadOptions();
      
      // Reset UI
      output.textContent = "⏳ Starting download...";
      updateStatus("Initializing");
      progressContainer.classList.add('active');
      updateProgress(0);
      
      // Disable start button, enable stop button
      startBtn.disabled = true;
      stopBtn.disabled = false;
      
      try {
        // Make request to server
        downloadProcess = await fetch('/download', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify(downloadOptions),
        });
        
        if (!downloadProcess.ok) {
          throw new Error(`Server error: ${downloadProcess.status}`);
        }
        
        const reader = downloadProcess.body.getReader();
        const decoder = new TextDecoder();
        
        output.textContent = "";
        let progress = 0;
        let downloadStarted = false;
        
        // Process stream from server
        while (true) {
          const { value, done } = await reader.read();
          if (done) break;
          
          const chunk = decoder.decode(value, { stream: true });
          output.textContent += chunk;
          output.scrollTop = output.scrollHeight;
          
          // Check if downloading has started
          if (chunk.includes("Downloading") && !downloadStarted) {
            updateStatus("Downloading");
            downloadStarted = true;
          }
          
          // Try to extract progress information from the output
          const lines = chunk.split('\n');
          for (const line of lines) {
            const extractedProgress = extractProgress(line);
            if (extractedProgress !== null) {
              progress = extractedProgress;
              updateProgress(progress);
            }
            
            // Check for completion indicators
            if (line.includes("Destination:") || line.includes("has already been downloaded")) {
              updateProgress(100);
            }
            
            // Check for conversion indicators
            if (line.includes("Converting")) {
              updateStatus("Converting");
            }
            
            // Check for errors
            if (line.includes("ERROR:")) {
              updateStatus("Failed", true);
            }
          }
        }
        
        // Download completed
        updateStatus("Completed");
        updateProgress(100);
        
        // Add successful download message
        output.textContent += "\n✅ Download completed successfully!\n";
        output.textContent += "📂 Files saved to the 'downloads' folder.";
        
      } catch (error) {
        console.error("Download error:", error);
        output.textContent += `\n❌ Download failed: ${error.message}`;
        updateStatus("Failed", true);
      } finally {
        // Reset UI state
        startBtn.disabled = false;
        stopBtn.disabled = true;
      }
    });
    
    stopBtn.addEventListener('click', async () => {
      if (downloadProcess) {
        // Make request to stop the download
        try {
          const response = await fetch('/stop', {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' }
          });
          
          if (response.ok) {
            output.textContent += "\n🛑 Download stopped.";
            updateStatus("Stopped");
          } else {
            throw new Error('Failed to stop download');
          }
        } catch (error) {
          console.error("Stop error:", error);
          output.textContent += "\n❌ Failed to stop download.";
        }
        
        // Abort the fetch if it's still active
        if (downloadProcess.abort) {
          downloadProcess.abort();
        }
      }
      
      // Reset UI state
      stopBtn.disabled = true;
      startBtn.disabled = false;
    });
    
    // Clean up URL when pasted
    document.getElementById('url').addEventListener('paste', (e) => {
      setTimeout(() => {
        const url = e.target.value.trim();
        e.target.value = url;
      }, 0);
    });
    
    // Auto-detect playlist URLs
    document.getElementById('url').addEventListener('change', (e) => {
      const url = e.target.value;
      if (url.includes('playlist') || url.includes('list=')) {
        // If it looks like a playlist URL, switch to playlist tab
        tabs.forEach(t => t.classList.remove('active'));
        tabContents.forEach(c => c.classList.remove('active'));
        
        const playlistTab = document.querySelector('.tab[data-tab="playlist"]');
        playlistTab.classList.add('active');
        document.getElementById('playlistContent').classList.add('active');
      }
    });
    
    // Add download completion notification
    function notifyDownloadComplete() {
      if ('Notification' in window) {
        if (Notification.permission === 'granted') {
          new Notification('Download Complete', {
            body: 'Your YouTube download has finished.',
            icon: 'https://www.youtube.com/favicon.ico'
          });
        } else if (Notification.permission !== 'denied') {
          Notification.requestPermission().then(permission => {
            if (permission === 'granted') {
              new Notification('Download Complete', {
                body: 'Your YouTube download has finished.',
                icon: 'https://www.youtube.com/favicon.ico'
              });
            }
          });
        }
      }
    }
    
    // Update backend to handle the new options
    // This requires updating your Flask app's /download endpoint to handle these parameters
    
    // Note: You'll need to modify your app.py to support these new options:
    // - Video quality selection
    // - Playlist range selection
    // - Creating folders for playlists
    
    // Example Python code changes needed in app.py:
    /*
    def generate_command(data):
        url = data.get("url")
        fmt = data.get("format", "best")
        quality = data.get("quality")
        is_playlist = data.get("isPlaylist", False)
        playlist_start = data.get("playlistStart")
        playlist_end = data.get("playlistEnd")
        create_folder = data.get("createFolder", True)
        
        cmd = ["yt-dlp"]
        
        # Format selection
        if fmt == "mp3":
            cmd.extend(["--extract-audio", "--audio-format", "mp3"])
        elif quality:
            cmd.extend(["-f", quality])
        else:
            cmd.extend(["-f", fmt])
        
        # Playlist options
        if is_playlist:
            cmd.append("--yes-playlist")
            if playlist_start:
                cmd.extend(["--playlist-start", playlist_start])
            if playlist_end:
                cmd.extend(["--playlist-end", playlist_end])
        else:
            cmd.append("--no-playlist")
        
        # Output format
        if is_playlist and create_folder:
            output_tpl = os.path.join(DOWNLOAD_FOLDER, "%(playlist_title)s/%(title)s.%(ext)s")
        else:
            output_tpl = os.path.join(DOWNLOAD_FOLDER, "%(title)s.%(ext)s")
            
        cmd.extend(["-o", output_tpl])
        
        # Add URL at the end
        cmd.append(url)
        
        return cmd
    
    @app.route('/download', methods=['POST'])
    def download():
        global current_process
        
        data = request.get_json()
        url = data.get("url")
        
        if not url:
            return Response("❌ Error: No URL provided\n", status=400, mimetype='text/plain')
        
        cmd = generate_command(data)
        
        def run_command():
            global current_process
            current_process = subprocess.Popen(cmd, stdout=subprocess.PIPE, stderr=subprocess.STDOUT, text=True)
            for line in iter(current_process.stdout.readline, ''):
                yield line
            current_process.stdout.close()
        
        return Response(run_command(), mimetype='text/plain')
    */
  </script>
</body>
</html>